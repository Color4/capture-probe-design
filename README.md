## Identifying exons for target capture in _Trifolium repens_

This repository contains scripts associated with identifying exons to be targeted with sequence capture probes in a large-scale project identifying the genome-wide consequences of urbanization. The goal is to begin with transcript sequences of a non-model organism (white clover in this case) and end with annotated exons with their corresponding boundaries identified in those transcripts. This approach is inspired by [Bi *et. al.* (2012)](https://bmcgenomics.biomedcentral.com/articles/10.1186/1471-2164-13-403) and [Bragg *et al.* (2016)](https://onlinelibrary.wiley.com/doi/abs/10.1111/1755-0998.12449). Briefly, the pipeline is as follows:

1. Obtain transcriptome sequence for study organism, either through a preliminary RNAseq experiment or from published literature and sequence repositories.
    * **Note:** It will help if the transcriptome is annotated. This can be done using [*blastx*](https://www.ncbi.nlm.nih.gov/books/NBK279684/), which matches the transcript nucleotide sequences against a database of protein sequences.
2. Download the reference genome of a closely related species (in FASTA format) and the genomic annotation file (a *.gff3* file is used in this pipeline)
3. Use the genomic annotation file to extract the sequences of all exons from the genomic fasta file. In this pipeline, exon sequences are additionally filtered to ensure no duplicates, no ambiguous nucleotides and only exons greater than 200 bp in length are kept. This step is done using [this script](scripts/python/01_retrieve-exons.py).
4. Perform a reciprocal best blast between the reference exon sequences and the transcript sequences. Keep only the top hit for each target and only hits with an Evalue < 1e<sup>-10</sup>. Additional filtering of final reciprocal hits (e.g. % identity or query sequence coverage threshholds) may be desired. This step is performed using [this script](scripts/python/02_reciprocal-best-blast.py).
    * In this pipeline, only a single exon per gene is kept since I am seeking to maximize the number of genes targeted. However, you may decide to only select the longest exons or have multiple exons per gene. These decisions should be based on the goals of the study.
5. Parse the final, filtered reciprocal best blast hits and retrieve the relevant sequences from the transcts using the start and end coordinates for the BLAST output. Ensure that strandedness is maintained. This step is performed using [this script](scripts/python/03_exon-targets.py).
